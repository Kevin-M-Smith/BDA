<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>Time Series Analysis</title>

<script src="body_files/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="body_files/bootstrap-2.3.2/css/spacelab.min.css" rel="stylesheet" />
<link href="body_files/bootstrap-2.3.2/css/bootstrap-responsive.min.css" rel="stylesheet" />
<script src="body_files/bootstrap-2.3.2/js/bootstrap.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="body_files/highlight/default.css"
      type="text/css" />
<script src="body_files/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
</style>
<div class="container-fluid main-container">


<div id="header">
<h1 class="title">Time Series Analysis</h1>
</div>


<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery-ui.min.js"></script>
<script type="text/javascript" src="https://cdn.rawgit.com/Kevin-M-Smith/BDA/master/Time%20Series%20Analysis/js/jquery.fancybox-1.3.4.pack.min.js"></script>
<script src="https://cdn.rawgit.com/Kevin-M-Smith/BDA/master/Time%20Series%20Analysis/js/jquery.tocify.js"></script>
<p><link type="text/css" rel="stylesheet" href="https://cdn.rawgit.com/Kevin-M-Smith/BDA/master/Time%20Series%20Analysis/css/jquery.tocify.css" /> <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.rawgit.com/Kevin-M-Smith/BDA/master/Time%20Series%20Analysis/css/jquery.fancybox-1.3.4.css" /></p>
<script src="https://cdn.rawgit.com/Kevin-M-Smith/scianimator/master/assets/js/jquery.scianimator.min.js"></script>
<head>
<div id="TOC" class="TOC">

</div>
<style type="text/css">
  a.fancybox img {
    border: none;
    -o-transform: scale(1,1); -ms-transform: scale(1,1); -moz-transform: scale(1,1); -webkit-transform: scale(1,1); transform: scale(1,1); -o-transition: all 0.2s ease-in-out; -ms-transition: all 0.2s ease-in-out; -moz-transition: all 0.2s ease-in-out; -webkit-transition: all 0.2s ease-in-out; transition: all 0.2s ease-in-out;
  } 
a.fancybox:hover img {
  position: relative; z-index: 999; -o-transform: scale(1.03,1.03); -ms-transform: scale(1.03,1.03); -moz-transform: scale(1.03,1.03); -webkit-transform: scale(1.03,1.03); transform: scale(1.03,1.03);
}

#TOC {
  position: fixed;
  left: 0;
  top: 0;
  width: 250px;
  overflow:auto;
}

#source{
  position: fixed;
  left: 0;
  bottom: 0;
  width: 250px;
  overflow:auto;
}

body {
  float: left; 
  margin: auto;
  margin-left:300px;
  line-height: 20px;
}

p { line-height: 1.5; }

.fancybox-title-inside {
  margin-left: 0px !important;
}


</style>
</head>
<body>
<script type="text/javascript">
  
  
  $(function($){
    $("#TOC").tocify({extendPage: true, selectors: "h1,h2,h3,h4"});
    var addToAll = true;
    var gallery = false;
    var titlePosition = 'inside';
    $(addToAll ? 'img' : 'img.fancybox').each(function(){
      var $this = $(this);
      var title = $this.attr('title');
      var src = $this.attr('data-big') || $this.attr('src');
      var a = $('<a href="#" class="fancybox"></a>').attr('href', src).attr('title', title);
      $this.wrap(a);
    });
    if (gallery)
      $('a.fancybox').attr('rel', 'fancyboxgallery');
    $('a.fancybox').fancybox({
      titlePosition: titlePosition
    });
  });
  
$.noConflict();

  
</script>
<script>
function toggle_R(){
$("pre").slideToggle(1);
setTimeout(function(){
$("div[data-unique*=" + $(".active")[0].getAttribute("data-unique") + "]")[0].scrollIntoView();
}, 100);

}
</script>
</body>
<div id="source" class="tocify">
<ul class="tocify-header nav nav-list">
<li class="tocify-item active" style="cursor: pointer;">
<a onclick='toggle_R();' >Show / Hide Source</a>
</li>
</ul>
</div>
<hr>
<div id="overview" class="section level1">
<h1>Overview</h1>
This project explores basic time series analysis techniques for two datasets. The first dataset is a complete record of the mean monthly flows of the Ganges from January 1934 to December 2013. The second dataset is a complete record of the mean monthly flows of the Nile (collected at Aswan Dam) from January 1871 to December 1984.
<hr>
</div>
<div id="the-ganges" class="section level1">
<h1>The Ganges</h1>
<div id="monthly-flow" class="section level2">
<h2>Monthly Flow</h2>
<div id="time-series" class="section level3">
<h3>Time Series</h3>
<p>A plot of the monthly time series reveals seasonality in the data. This structure will need to be removed before we can assess the stationarity of the time series.</p>
<pre class="r"><code>p1 = ggplot(dfg, aes(y=Flow, x=idx)) + geom_line() + theme_bw() 
p1 = p1 + ggtitle(&quot;Monthly Mean Flows for Ganges [ 1934 - 2012 ]&quot;)
p1 = p1 + xlab(&quot;&quot;) + ylab(&quot;Flow (CFS)&quot;)
p1 = p1 + theme(axis.title.y = element_text(vjust=1.5),
                axis.title.x = element_text(vjust=-0.5),
                plot.title = element_text(vjust=1.5)
                )


p11 = ggplot(dfg, aes(y=log(Flow), x=idx)) + geom_line() + theme_bw()
p11 = p11 + xlab(&quot;Index&quot;) + ylab(&quot;Log Flow&quot;)
p11 = p11 + theme(axis.title.y = element_text(vjust=1.5),
                axis.title.x = element_text(vjust=-0.5),
                plot.title = element_text(vjust=1.5)
                )

#p11 = p11 + geom_smooth(method = &quot;loess&quot;, size = 1.5)
p11 = p11 + theme(plot.margin=unit(c(0,4,10,7),&quot;mm&quot;))

grid.arrange(p1, p11, nrow=2)</code></pre>
<img src="body_files/figure-html/fig1-1.png" title="79 years of mean monthly flow data for the Ganges in real space (top) and log space (bottom)." alt="79 years of mean monthly flow data for the Ganges in real space (top) and log space (bottom)." style="display: block; margin: auto;" /><b>
<p class="caption" align="center">
Figure 1: 79 years of mean monthly flow data for the Ganges in real space (top) and log space (bottom).
</p>
<p></b> <br></p>
</div>
<div id="boxplots" class="section level3">
<h3>Boxplots</h3>
<p>Within-year seasonality is highlighted in this boxplot of monthly mean flows. During the year there seems to be ‘wet’ and ‘dry’ seasons of differing lengths. These seasons will be independently analyzed in sections 3 and 4.</p>
<pre class="r"><code>p2 = ggplot(dfg, aes(y=Flow, x=MID)) + geom_boxplot() + theme_bw()

p2 = p2 + ggtitle(paste(&quot;Boxplot of Monthly Mean Flows for Ganges [&quot;,
                   min(dfg$Year), 
                   &quot;-&quot;,
                   max(dfg$Year),
                   &quot;]&quot;))

p2 = p2 + xlab(&quot;Month&quot;) + ylab(&quot;Flow (CFS)&quot;)
p2 = p2 + theme(axis.title.y = element_text(vjust=1.5),
                axis.title.x = element_text(vjust=-0.5),
                plot.title = element_text(vjust=1.5)
                )

p2</code></pre>
<img src="body_files/figure-html/fig2-1.png" title="A series of boxplots showing the center and spread of the dataset by month. The signal appears highly seasonal." alt="A series of boxplots showing the center and spread of the dataset by month. The signal appears highly seasonal." style="display: block; margin: auto;" /><b>
<p class="caption" align="center">
Figure 2: A series of boxplots showing the center and spread of the dataset by month. The signal appears highly seasonal.
</p>
<p></b> <br></p>
</div>
<div id="sample-statistics" class="section level3">
<h3>Sample Statistics</h3>
<pre class="r"><code>pander(tab1, style = &#39;rmarkdown&#39;, justify=&#39;center&#39;)</code></pre>
<table>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Mean (CFS)</th>
<th align="center">SD (CFS)</th>
<th align="center">CV</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">January</td>
<td align="center">2537</td>
<td align="center">1124</td>
<td align="center">0.443</td>
</tr>
<tr class="even">
<td align="center">February</td>
<td align="center">2014</td>
<td align="center">843.5</td>
<td align="center">0.4189</td>
</tr>
<tr class="odd">
<td align="center">March</td>
<td align="center">1663</td>
<td align="center">765.6</td>
<td align="center">0.4603</td>
</tr>
<tr class="even">
<td align="center">April</td>
<td align="center">1519</td>
<td align="center">648.7</td>
<td align="center">0.427</td>
</tr>
<tr class="odd">
<td align="center">May</td>
<td align="center">1758</td>
<td align="center">574.2</td>
<td align="center">0.3266</td>
</tr>
<tr class="even">
<td align="center">June</td>
<td align="center">3988</td>
<td align="center">1618</td>
<td align="center">0.4057</td>
</tr>
<tr class="odd">
<td align="center">July</td>
<td align="center">18760</td>
<td align="center">5860</td>
<td align="center">0.3123</td>
</tr>
<tr class="even">
<td align="center">August</td>
<td align="center">37200</td>
<td align="center">8042</td>
<td align="center">0.2162</td>
</tr>
<tr class="odd">
<td align="center">September</td>
<td align="center">35990</td>
<td align="center">8399</td>
<td align="center">0.2334</td>
</tr>
<tr class="even">
<td align="center">October</td>
<td align="center">17370</td>
<td align="center">6489</td>
<td align="center">0.3735</td>
</tr>
<tr class="odd">
<td align="center">November</td>
<td align="center">6505</td>
<td align="center">2291</td>
<td align="center">0.3522</td>
</tr>
<tr class="even">
<td align="center">December</td>
<td align="center">3762</td>
<td align="center">1657</td>
<td align="center">0.4406</td>
</tr>
<tr class="odd">
<td align="center"><strong>Overall</strong></td>
<td align="center"><strong>11090</strong></td>
<td align="center"><strong>13460</strong></td>
<td align="center"><strong>1.214</strong></td>
</tr>
</tbody>
</table>
<p><br></p>
</div>
<div id="stationarity-assessment" class="section level3">
<h3>Stationarity Assessment</h3>
<p>The monthly time series is not even first-order stationary becuase the mean exhibits strong seasonality. However, the highly seasonal structure suggests that we may be able to make the time series stationary though differencing. The correlation at lag 12 is particularly strong, so let us begin there.</p>
<pre class="r"><code>for(i in 1:12){
dfg.lag12 = rep(NA, length(dfg$Flow))
dfg.lag12[1:12==(i)] = dfg$Flow[1:12==(i)]
p1 = ggplot(dfg, aes(y=Flow, x=idx)) + geom_line() + theme_bw() + geom_point(aes(y=dfg.lag12))
p1 = p1 + ggtitle(&quot;Monthly Mean Flows for Ganges [ 1934 - 2012 ]&quot;)
p1 = p1 + xlab(&quot;Index&quot;) + ylab(&quot;Flow (CFS)&quot;)
p1 = p1 + theme(axis.title.y = element_text(vjust=1.5),
                axis.title.x = element_text(vjust=-0.5),
                plot.title = element_text(vjust=1.5)
                )
print(p1)
}</code></pre>
<div class="scianimator">
<div id="anim" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(12);
      for (i=0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "body_files/figure-html/anim-" + (i + 1) + ".png";
      }
      $("#anim").scianimator({
          "images": imgs,
          "delay": 100,
          "controls": "none",
      });
      $("#anim").scianimator("play");
    });
  })(jQuery);
</script>
<b>
<p class="caption" align="center">
Figure 3: Ganges monthly mean flows with <em>i</em>+12 observations highlighted.
</p>
<p></b></p>
<pre class="r"><code>q1 = ggacf(dfg$Flow) + xlab(&quot; &quot;) + theme(plot.margin=unit(c(2,2,2,2),&quot;mm&quot;))
q2 = ggpacf(dfg$Flow) + theme(plot.margin=unit(c(2,2,2,2),&quot;mm&quot;))

grid.arrange(q1, q2, nrow = 2)</code></pre>
<img src="body_files/figure-html/unnamed-chunk-1-1.png" title="Total and partial correlograms for the monthly series." alt="Total and partial correlograms for the monthly series." style="display: block; margin: auto;" /><b>
<p class="caption" align="center">
Figure 4: Total and partial correlograms for the monthly series.
</p>
<p></b></p>
</div>
<div id="differencing" class="section level3">
<h3>Differencing</h3>
<p>After differencing the series at lag 12, the mean appears stable. The partial</p>
<pre class="r"><code>tsd = diff(dfg$Flow, 12)
tsd = data.frame(value = tsd, idx = dfg$idx[-1:-12])
p1 = ggplot(tsd, aes(y=value, x=idx)) + geom_line() + theme_bw() 
p1 = p1 + ggtitle(&quot;Differenced (d=12) Monthly Mean Flows for Ganges [ 1946 - 2012 ]&quot;)
p1 = p1 + xlab(&quot;Index&quot;) + ylab(&quot;Flow (CFS)&quot;)
p1 = p1 + theme(axis.title.y = element_text(vjust=1.5),
                axis.title.x = element_text(vjust=-0.5),
                plot.title = element_text(vjust=1.5)
)
p1</code></pre>
<img src="body_files/figure-html/unnamed-chunk-2-1.png" title="Differenced (d=12) Monthly Mean Flow Series" alt="Differenced (d=12) Monthly Mean Flow Series" style="display: block; margin: auto;" /><b>
<p class="caption" align="center">
Figure 5: Differenced (d=12) Monthly Mean Flow Series
</p>
<p></b></p>
<pre class="r"><code>q1 = ggacf(tsd$value) + xlab(&quot; &quot;) + theme(plot.margin=unit(c(2,2,2,2),&quot;mm&quot;))
q2 = ggpacf(tsd$value) + theme(plot.margin=unit(c(2,2,2,2),&quot;mm&quot;))
grid.arrange(q1, q2, nrow = 2)</code></pre>
<img src="body_files/figure-html/unnamed-chunk-3-1.png" title="Total and partial correlograms for the differenced (d=12) series." alt="Total and partial correlograms for the differenced (d=12) series." style="display: block; margin: auto;" /><b>
<p class="caption" align="center">
Figure 6: Total and partial correlograms for the differenced (d=12) series.
</p>
<p></b></p>
</div>
<div id="arima" class="section level3">
<h3>ARIMA</h3>
<p>Here we con</p>
<pre class="r"><code>AIC =  matrix(ncol = 14, nrow = 14)
colnames(AIC) = paste(&#39;&#39;, 0:13, sep=&#39;&#39;)
rownames(AIC) = paste(&#39;&#39;, 0:13, sep=&#39;&#39;)

load(&quot;gAIC&quot;)

for(p in 0:13){
  for(q in 0:13){
    tryCatch({
      # a &lt;- arima(tsd$value, order=c(p, 0, q))
      # if(exists(&quot;a&quot;)) AIC[q + 1, p + 1] &lt;- floor(a$aic)
      
    }, error = function(cond){})
  }
}

pq = which(AIC == min(AIC), arr.ind=TRUE)
qbest = pq[,1]-1;
pbest = pq[,2]-1;

levelplot(t(AIC), panel=function(...) {
  arg &lt;- list(...)
  panel.levelplot(...)
  panel.text(arg$x, arg$y, round(arg$z,1))
  panel.rect(xleft=pbest+0.5, xright=pbest+1.5, ytop=qbest+1.5, ybottom=qbest+0.5, lwd=4, border=&quot;red&quot;)
  },
  col.regions=colorRampPalette(brewer.pal(9,&quot;Greys&quot;)[3:7])(25),
  xlab = &quot;p&quot;,
  ylab = list(&quot;q&quot;, rot=0),
  main = &quot;AIC&quot;)</code></pre>
<p><img src="body_files/figure-html/unnamed-chunk-4-1.png" /></p>
<pre class="r"><code>tsd.fit = arima(tsd$value, order=c(pbest, 0, qbest))

q1 = ggacf.th(tsd$value, fit = tsd.fit) + xlab(&quot; &quot;) + theme(plot.margin=unit(c(2,2,2,2),&quot;mm&quot;))
q2 = ggpacf.th(tsd$value, fit = tsd.fit) + theme(plot.margin=unit(c(2,2,2,2),&quot;mm&quot;))

grid.arrange(q1, q2, nrow = 2)</code></pre>
<p><img src="body_files/figure-html/unnamed-chunk-5-1.png" alt="Differenced (d=12) Monthly Mean Flow Series" /></p>
</div>
</div>
<div id="arima-1" class="section level2">
<h2>ARIMA</h2>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
